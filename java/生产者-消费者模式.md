# 生产者-消费者模式

>生产者消费者模式并不是GOF提出的23种设计模式之一，23种设计模式都是建立在面向对象的基础之上的，但其实面向过程的编程中也有很多高效的编程模式，生产者消费者模式便是其中之一，它是我们编程过程中最常用的一种设计模式。

在实际的软件开发过程中，经常会碰到如下场景：某个模块负责产生数据，这些数据由另一个模块来负责处理（此处的模块是广义的，可以是类、函数、线程、进程等）。产生数据的模块，就形象地称为生产者；而处理数据的模块，就称为消费者。生产者和消费者之间通过缓冲区进行数据传递。

常用的缓冲区：

- 线程级：队列（FIFO）
- 进程级：匿名管道
- Socket（TCP方式）：生产者进程：生产线程-->发送缓冲区-->发送线程-->TCP/框架/API-->接收线程-->接受缓冲区-->消费线程。

**优点**：

- 实现生产者与消费者的解耦；
- 支持并发；
- 支持忙闲不均；

**数据单元**：生产者与消费者传递数据的最小单元；

- 关联到业务对象

- 完整性：传递的数据要完整；
- 数据独立：指各单元数据之间没有依赖；
- 颗粒度：每次存、取数据单元的数量；

**分类**：

|  类别  | 生产者线程 | 消费者线程 |
| :----: | :--------: | :--------: |
| 单对单 |     1      |     1      |
| 单对多 |     1      |   N(N>1)   |
| 多对单 |   N(N>1)   |     1      |
| 多对多 |   N(N>1)   |   N(N>1)   |

